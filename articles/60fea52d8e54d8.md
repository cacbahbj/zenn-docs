---
title: "M1 Macã§Kubernetes"
emoji: "ğŸ‘Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["kubernetes", "mac"]
published: false
---
# Kubernetesã¨ã¯

Kubernetesã‚’ã“ã‚Œã‹ã‚‰å§‹ã‚ã‚‹ã¨ã„ã†æ–¹ã«ã¯ã€ã“ã¡ã‚‰ã®ã‚µã‚¤ãƒœã‚¦ã‚ºç ”ä¿®è³‡æ–™ãŒã‚ªã‚¹ã‚¹ãƒ¡ã§ã™
https://cybozu.github.io/introduction-to-kubernetes/

å…¬å¼ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã“ã“ã§ã™
https://kubernetes.io/ja/docs/home/

# ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ

ãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ã‹ã™ãŸã‚ã«ã¯ä¸»ã«ä»¥ä¸‹ã®2ã¤ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™

- Minikube
- Docker for mac

ä»Šå›ã¯èµ·å‹•æ™‚ã«Kubernetesã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒæŒ‡å®šã§ãã‚‹Minikubeã‚’ä½¿ã„ã¾ã™

https://kubernetes.io/ja/docs/setup/learning-environment/minikube/
https://docs.docker.com/desktop/kubernetes/

Minikubeã¯kubectlã‚³ãƒãƒ³ãƒ‰ã‚‚ä½¿ç”¨ã™ã‚‹ã®ã§ã™ãŒã€ã“ã¡ã‚‰ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¾å­˜ãŒã‚ã‚‹ã®ã§asdfã‚’ä½¿ã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™
â€»brewã‚’ä½¿ç”¨ã™ã‚‹ã¨ä¾å­˜é–¢ä¿‚ã§æœ€æ–°ã®kubernetes-cliãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹ã‚ˆã†ã§ã™

> kubectlã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ãƒã‚¤ãƒŠãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã®å·®åˆ†ãŒ1ã¤ä»¥å†…ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚ãŸã¨ãˆã°ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒv1.2ã§ã‚ã‚Œã°ã€v1.1ã€v1.2ã€v1.3ã®ãƒã‚¹ã‚¿ãƒ¼ã§å‹•ä½œã™ã‚‹ã¯ãšã§ã™ã€‚æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®kubectlã‚’ä½¿ã†ã“ã¨ã§ã€ä¸æ¸¬ã®äº‹æ…‹ã‚’é¿ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã§ã—ã‚‡ã†ã€‚

https://kubernetes.io/ja/docs/tasks/tools/install-kubectl/

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

minikubeï¼ˆæœ€æ–°ç‰ˆã§OKï¼‰
```
$ asdf plugin add minikube
$ asdf install minikube latest
$ asdf global minikube 1.25.2
```
kubectlï¼ˆä½¿ã„ãŸã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å…¥ã‚Œã‚‹ï¼‰
```
$ asdf plugin add kubectl
$ asdf install kubectl latest
$ asdf global kubectl 1.23.6
```

â€»å°‘ã—å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å…¥ã‚Œã‚‹ã¨ãã¯ç’°å¢ƒå¤‰æ•°ã®è¨­å®šãŒå¿…è¦ã«ãªã‚Šã¾ã™
```
$ ASDF_KUBECTL_OVERWRITE_ARCH=amd64 asdf install kubectl 1.20.15
$ asdf global kubectl 1.20.15
```

## èµ·å‹•ã€åœæ­¢ã€å‰Šé™¤

```
$ minikube start
# ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®š
$ minikube start --kubernetes-version v1.20.15

$ minikube stop
$ minikube delete --all
```

## ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

ã‚¯ãƒ©ã‚¹ã‚¿ã®çŠ¶æ³ã‚’GUIã§ç¢ºèªã§ãã‚‹
```
$ minikube dashboard
```

# Kustomize

Kubernetes1.14ä»¥é™ã¯kubectlã‚³ãƒãƒ³ãƒ‰ã«çµ±åˆã•ã‚ŒãŸã®ã§ã™ãŒã€
å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ã„ãŸã„å ´åˆã¯è‡ªåˆ†ã§å…¥ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

```
$ cd ~/bin
$ curl -s "https://raw.githubusercontent.com/kubernetes-sigs/kustomize/master/hack/install_kustomize.sh"  | bash -s -- 3.8.10
```

â€»ãƒã‚¤ãƒŠãƒªãŒç”¨æ„ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å¤‰æ›´ã—ã¦å®Ÿè¡Œã—ã¾ã™
```
$ arch -x86_64 /bin/zsh
$ uname -m
x86_64

# ä½œæ¥­çµ‚ã‚ã£ãŸã‚‰â†“ã§çµ‚äº†
$ exit
$ uname -m
arm64
```

`~/.zshrc`ã‚’ç·¨é›†ã—ã¦ãƒ‘ã‚¹ã‚’é€šã—ã¦ãŠãã¾ã™
```
$ vi ~/.zshrc
export PATH="$HOME/bin:$PATH"

$ source ~/.zshrc
```
YAMLã‚’ç”Ÿæˆã—ãŸã‚Šã€ç›´æ¥applyã§ãã¾ã™
```
$ kustomize build ~/someApp
$ kustomize build ~/someApp | kubectl apply -f -
```

è©³ç´°ã¯ä»¥ä¸‹å‚ç…§
https://github.com/kubernetes-sigs/kustomize
https://kubectl.docs.kubernetes.io

kubectlã‹ã‚‰ä½¿ã†å ´åˆã¯ã“ã¡ã‚‰
https://kubernetes.io/docs/tasks/manage-kubernetes-objects/kustomization/

#
