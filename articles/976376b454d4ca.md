---
title: "CircleCIã¨Slackã‚’é€£æºã™ã‚‹"
emoji: "ğŸ™"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["circleci", "slack"]
published: true
---
Orbs > circleci/slack@4.4.4 ã§ã®è¨­å®šæ–¹æ³•ã§ã™

ä»¥å‰ã¯webhookã‚„Slackã«å…¬å¼ã§ç”¨æ„ã•ã‚Œã¦ã„ãŸCircleCIã®ã‚¢ãƒ—ãƒªã§è¨­å®šã—ãŸã‚ˆã†ã§ã™ãŒã€
ç¾åœ¨ã¯Orbsã‚’ä½¿ã†æ–¹æ³•ã«ãªã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™

# è¨­å®š

ã¾ãšã¯ã“ã¡ã‚‰ã®æ‰‹é †ã«å¾“ã£ã¦SlackAppã‚’ä½œæˆã—ã¾ã™
https://github.com/CircleCI-Public/slack-orb/wiki/Setup

CircleCIã®Contextã¾ãŸã¯è©²å½“ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®šã«ã€
Slackã®ãƒˆãƒ¼ã‚¯ãƒ³ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒ£ãƒ³ãƒãƒ«ã‚’è¨­å®šã—ã¾ã™

- SLACK_ACCESS_TOKEN
- SLACK_DEFAULT_CHANNEL

â€» ä»Šå›ã¯Project Settings -> Environment Variablesã«è¨­å®šã—ã¦ã„ã¾ã™

# ymlãƒ•ã‚¡ã‚¤ãƒ«

https://circleci.com/docs/ja/2.0/configuration-reference/

commandsã‚’ä½¿ã£ã¦æˆåŠŸæ™‚ã¨å¤±æ•—æ™‚ã®å®šç¾©ã‚’ã—ã¾ã™
```
version: 2.1
orbs:
  slack: circleci/slack@4.4.4
commands:
  notify_slack_pass:
    steps:
    - slack/notify:
        event: pass
        template: basic_success_1
  notify_slack_fail:
    steps:
    - slack/notify:
        event: fail
        template: basic_fail_1
```

ä½¿ç”¨ã§ãã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ä»¥ä¸‹ï¼ˆä¸Šè¨˜ä»¥å¤–ã«holdã‚„deployãŒã‚ã‚Šã¾ã™ï¼‰
https://github.com/CircleCI-Public/slack-orb/wiki

ã‚¤ãƒ™ãƒ³ãƒˆã‚„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæŒ‡å®šã®ä»–ã€
`mentions`ã§ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ãŸã‚Š
`branch_pattern`ã§ãƒ–ãƒ©ãƒ³ãƒã‚’æ­£è¦è¡¨ç¾ã§æŒ‡å®šã§ããŸã‚Šã—ã¾ã™

è©³ã—ãã¯ã“ã¡ã‚‰ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹æ–¹æ³•ãªã©ã‚‚æ›¸ã„ã¦ã‚ã‚Šã¾ã™ï¼‰
https://circleci.com/developer/ja/orbs/orb/circleci/slack

ã‚ã¨ã¯é€šçŸ¥ã—ãŸã„jobã®stepã«ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§ã™
```
jobs:
  build:
      :
    steps:
      - checkout
          :
      - notify_slack_fail
      - notify_slack_pass
```
å¤±æ•—ã€æˆåŠŸã®ä¸¡æ–¹é€šçŸ¥ã—ãŸã„å ´åˆã¯ä¸¡æ–¹æ›¸ã‘ã°OKã§ã™
