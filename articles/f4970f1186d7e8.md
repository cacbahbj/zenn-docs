---
title: "CircleCIã§imageã®pushå…ˆã‚’GCRã‹ã‚‰ArtifactRegistryã«ç§»è¡Œã™ã‚‹"
emoji: "ğŸ˜º"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["circleci","gcr","artifactregistry"]
published: true
---
# ã¯ã˜ã‚ã«

GCRã®å»ƒæ­¢ã«ä¼´ã†ArtifactRegistryç§»è¡Œã®ãƒ¡ãƒ¢ã§ã™
ç§»è¡Œã®æ–¹æ³•ã¨ã—ã¦ã¯ä»¥ä¸‹ã®2ç¨®é¡ãŒã‚ã‚Šã¾ã™
ï¼ˆä»Šå›ã¯GARã§ã®pushå…ˆã‚’éšå±¤åŒ–ã™ã‚‹ã®ã§â†“ã®2ã§ã‚„ã‚Šã¾ã™ï¼‰

1. gcr.io ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã«ç§»è¡Œâ†’ã“ã¡ã‚‰ã¯ARã®å…¨ã¦ã®æ©Ÿèƒ½ãŒä½¿ãˆã¾ã›ã‚“
2. æ¨™æº–ãƒªãƒã‚¸ãƒˆãƒªã«ç§»è¡Œ

åŸ·ç­†æ™‚ç‚¹ã§ã¯å»ƒæ­¢ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ä»¥ä¸‹ã«ãªã£ã¦ã„ã¾ã™ï¼ˆ2024/04ï¼‰
> Container Registry ã¯éæ¨å¥¨ã§ã€æä¾›çµ‚äº†ã¨ãªã‚Šã¾ã™ã€‚2024 å¹´ 5 æœˆ 15 æ—¥ä»¥é™ã€Artifact Registry ã¯ã€Container Registry ã®ä½¿ç”¨æ­´ãŒãªã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ gcr.io ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ›ã‚¹ãƒˆã—ã¾ã™ã€‚2025 å¹´ 3 æœˆ 18 æ—¥ä»¥é™ã€Container Registry ã¯ã”åˆ©ç”¨ã„ãŸã ã‘ãªããªã‚Šã¾ã™ã€‚

æ­£ç¢ºãªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ä»¥ä¸‹ã®ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆå‚ç…§ã—ã¦ä¸‹ã•ã„
https://cloud.google.com/container-registry/docs/release-notes?hl=ja

é–¢é€£è³‡æ–™ã§ã™
https://cloud.google.com/artifact-registry/docs/transition/setup-gcr-repo?hl=ja
https://cloud.google.com/artifact-registry/docs/transition/setup-repo?hl=ja

ä»¥ä¸‹ã®ä½œæ¥­ãªã©ã‚„ã£ã¦ãŠãã¾ã™
- GARã®ãƒªãƒã‚¸ãƒˆãƒªä½œæˆ
- IAMæ¨©é™ä»˜ä¸
- æ—¢å­˜ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚³ãƒ”ãƒ¼

# CircleCIè¨­å®šå¤‰æ›´

imageã®pushã¯GCRç”¨ã®`circleci/gcp-gcr`ãŒGARã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™
ï¼ˆ2024/04æ™‚ç‚¹ã§ã¯0.16.2ã§å‹•ä½œã—ã¦ã„ã¾ã™ï¼‰

```
orbs:
  gcp-gcr: circleci/gcp-gcr@0.16.2

jobs:
  build:
      :
    steps:
        :
      - gcp-gcr/gcr-auth
      - gcp-gcr/push-image:
          image: image_name
          tag: "$CIRCLE_SHA1",latest
          registry-url: xxx.gcr.io
```
â†“æ›¸ãæ›ãˆã¾ã™
```
orbs:
  gcp-gcr: circleci/gcp-gcr@0.16.2

jobs:
  build:
      :
    steps:
        :
      - gcp-gcr/gcr-auth:
          registry-url: xxx-docker.pkg.dev
      - gcp-gcr/push-image:
          image: path/image_name
          tag: ${CIRCLE_SHA1},latest
          registry-url: xxx-docker.pkg.dev
```
`gcr-auth`ã§`registry-url`ã®è¨˜è¼‰ãŒå¿…è¦ã«ãªã‚Šã¾ã™
â†’è©³ç´°ã¯ä¸‹è¨˜ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰ã‚³ãƒãƒ³ãƒ‰ã®`Show Command Source`ã‚’ç¢ºèª
â†’ã‚¤ãƒ¡ãƒ¼ã‚¸ã®pushã‚’è¡Œã†ãŸã‚ã®GARã¸ã®èªè¨¼ã‚’æ§‹æˆã—ã¦ã„ã¾ã™

ãªãŠã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã¯ç’°å¢ƒå¤‰æ•°`GOOGLE_PROJECT_ID`ã§è¨­å®šã—ã¦ã„ã¾ã™

https://circleci.com/developer/ja/orbs/orb/circleci/gcp-gcr#commands
